<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${profileUser.username} + ' - Profile'">Profile</title>
    <link rel="stylesheet" href="/css/styles.min.css">
    <style>
        :root { --bg:#f5f7fb; --card:#ffffff; --ink:#0f172a; --muted:#6b7280; --brand:#0ea5e9; --line:#eaeef4; }
        * { box-sizing:border-box; }
        html,body { height:100%; }
        body { margin:0; font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--ink); background:var(--bg); }
        .wrapper { min-height:100%; display:flex; flex-direction:column; }
        .topbar { display:flex; align-items:center; gap:14px; padding:10px 16px; border-bottom:1px solid var(--line); background:var(--card); flex-wrap:nowrap; }
        .brand { font-weight:800; letter-spacing:.2px; }
        .nav { display:flex; gap:16px; margin:0 12px; flex:1; overflow:auto; white-space:nowrap; }
        .nav a { text-decoration:none; color:#111827; font-weight:500; padding:8px 10px; border-radius:8px; }
        .nav a:hover { background:#f3f4f6; }
        .top-actions { margin-left:auto; display:flex; align-items:center; gap:12px; position:relative; flex-wrap:nowrap; }
        .user-btn{display:flex;align-items:center;gap:6px;cursor:pointer;color:#111827;border:1px solid var(--line);padding:6px 10px;border-radius:8px;background:#fff}
        .user-menu{position:absolute; right:0; top:48px; background:#fff; border:1px solid var(--line); border-radius:10px; box-shadow:0 10px 25px rgba(0,0,0,.08); width:200px; display:none; z-index:5}
        .user-menu .item{display:block; padding:10px 12px; color:#111827; text-decoration:none}
        .user-menu .item:hover{background:#f3f4f6}
        .search { position:relative; }
        .search input { height:34px; width:220px; padding:0 12px; border:1px solid var(--line); border-radius:8px; outline:none; }
        .cart { position:relative; width:28px; height:28px; display:grid; place-items:center; border:1px solid var(--line); border-radius:8px; text-decoration:none; color:#111827; }
        .cart .badge{ position:absolute; top:-6px; right:-6px; background:#ef4444; color:#fff; min-width:18px; height:18px; border-radius:9px; font-size:11px; display:flex; align-items:center; justify-content:center; padding:0 5px; }
        .content { max-width:1000px; margin:18px auto; background:var(--card); border:1px solid var(--line); border-radius:14px; padding:24px; }
        .row { display:flex; gap:24px; align-items:flex-start; }
        .avatar { width:140px; height:140px; border-radius:70px; object-fit:cover; border:1px solid var(--line); }
        .label { color:var(--muted); font-size:13px; }
        .value { font-weight:600; margin-bottom:12px; }
        .notice { background:#fff7ed; border:1px solid #fed7aa; color:#9a3412; padding:8px 12px; border-radius:8px; display:inline-flex; align-items:center; gap:8px; font-size:13px; }
    </style>
</head>
<body>
<div class="wrapper">
        <div class="topbar" style="display:flex;align-items:center;gap:14px;">
        <div class="brand">BanHangRong</div>
        <nav class="nav" aria-label="Main">
            <a href="/customer/dashboard">Home</a>
            <a href="/categories">Category</a>
            <a href="#">License Software</a>
            <a href="#">Game Keys</a>
            <a href="#">Voucher</a>
            <a href="#">Support</a>
        </nav>
        <div class="top-actions">
            <div class="notif">Notification</div>
            <div class="user" style="position:relative">
                <button id="userMenuBtn" class="user-btn" type="button" aria-haspopup="menu" aria-expanded="false">
                    <span th:text="${user != null ? user.username : 'User123456'}">User123456</span>
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5" stroke="#6b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                </button>
                <div id="userDropdown" class="user-menu" role="menu" aria-label="User menu">
                    <a class="item" th:href="@{'/customer/profile/' + ${user.username}}" role="menuitem">T√†i kho·∫£n c·ªßa t√¥i</a>
                    <a class="item" href="#" role="menuitem">ƒê∆°n mua</a>
                    <a class="item seller-apply" href="/seller/dashboard" role="menuitem" style="background:#f8fafc;border-top:1px solid #e2e8f0;color:#0ea5e9;font-weight:600;">üìà Applied to become a seller</a>
                    <a class="item" href="#" role="menuitem" onclick="event.preventDefault(); document.getElementById('logoutForm').submit();">ƒêƒÉng xu·∫•t</a>
                </div>
                <form id="logoutForm" method="post" action="/logout" style="display:none;">
                </form>
            </div>
            <div class="search">
                <form method="GET" action="/customer/dashboard" style="display:flex;gap:4px;flex-wrap:nowrap;align-items:center;">
                    <input type="search" name="search" placeholder="search" aria-label="Search" 
                           th:value="${search}" style="height:34px;width:220px;padding:0 12px;border:1px solid var(--line);border-radius:8px;outline:none;">
                    <button type="submit" style="padding:8px 12px;background:var(--brand);color:#fff;border:none;border-radius:8px;cursor:pointer;">üîç</button>
                    <a th:if="${search != null and !search.trim().isEmpty()}" 
                       th:href="@{/customer/dashboard}" 
                       style="padding:8px 12px;background:#6b7280;color:#fff;text-decoration:none;border-radius:8px;display:flex;align-items:center;">‚úï</a>
                </form>
            </div>
            <a href="/cart" class="cart" title="Gi·ªè h√†ng" aria-label="Gi·ªè h√†ng">üõí<span class="badge" th:text="${cartCount}" th:if="${cartCount != null and cartCount > 0}">0</span></a>
        </div>
    </div>

    <section class="content">
        <div class="row" style="justify-content:space-between;align-items:flex-start;">
            <span>
                <img class="avatar" th:if="${profileUser != null and profileUser.avatarUrl != null and !#strings.isEmpty(#strings.trim(profileUser.avatarUrl))}"
                     th:src="${profileUser.avatarUrl}" src="/img/avatar_default.jpg"
                     onerror="this.onerror=null;this.src='/img/avatar_default.jpg';" alt="Avatar"/>
                <img class="avatar" th:unless="${profileUser != null and profileUser.avatarUrl != null and !#strings.isEmpty(#strings.trim(profileUser.avatarUrl))}"
                     src="/img/avatar_default.jpg" alt="Avatar"/>
            </span>
            <div style="flex:1;max-width:520px;">
                <div class="label">Username</div>
                <div class="value" th:text="${profileUser.username}">username</div>
                <div class="label">Email</div>
                <div class="value" th:text="${profileUser.email}">email@example.com</div>
                <div th:if="${profileUser.isEmailVerified == null || !profileUser.isEmailVerified}" class="notice">
                    Email ch∆∞a ƒë∆∞·ª£c x√°c th·ª±c
                    <form method="post" action="/customer/profile/verify-email" style="margin:0">
                        <button type="submit" class="btn" style="padding:6px 10px;border:1px solid #fed7aa;background:#fff;border-radius:8px;margin-left:8px;">Verify now</button>
                    </form>
                </div>
                <div class="label">Phone</div>
                <div class="value" th:text="${profileUser.phoneNumber}">-</div>
                <div class="label">Gender</div>
                <div class="value" th:text="${profileUser.gender != null ? profileUser.gender : '-'}">-</div>
                <div class="label">Birth date</div>
                <div class="value" th:text="${profileUser.birthDate != null ? #temporals.format(profileUser.birthDate, 'dd/MM/yyyy') : '-'}">-</div>
                <div class="label">Balance</div>
                <div class="value" th:text="${profileUser.balance != null ? #numbers.formatDecimal(profileUser.balance,0,'COMMA',0,'POINT') + '‚Ç´' : '0‚Ç´'}">0‚Ç´</div>
            </div>
            <div>
                <a th:href="@{'/customer/profile/' + ${user.username} + '/edit'}" class="btn" style="padding:10px 16px;border:1px solid var(--line);border-radius:10px;background:#fff;">Edit</a>
            </div>
        </div>
    </section>
</div>
<script>
(function(){
    const btn = document.getElementById('userMenuBtn');
    const menu = document.getElementById('userDropdown');
    function close(){ if(menu) { menu.style.display='none'; btn && btn.setAttribute('aria-expanded','false'); } }
    function toggle(){ if(!menu) return; const show = menu.style.display !== 'block'; menu.style.display = show ? 'block':'none'; btn && btn.setAttribute('aria-expanded', show?'true':'false'); }
    if(btn){ btn.addEventListener('click', (e)=>{ e.stopPropagation(); toggle(); }); }
    document.addEventListener('click', close);
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') close(); });
})();
</script>
</body>
</html>


