<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
<title>History Order - BanHangRong</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
	<style>
:root {
  --bg:#f5f7fb; --card:#ffffff; --line:#e5e7eb;
  --muted:#6b7280; --brand:#0ea5e9;
}
body {
  font-family:'Inter',sans-serif;
  background:var(--bg);
  margin:0;
}
.wrapper{display:flex;flex-direction:column;min-height:100vh}
.topbar{display:flex;align-items:center;gap:14px;padding:10px 16px;border-bottom:1px solid var(--line);background:var(--card);flex-wrap:nowrap}
.brand{font-weight:800;letter-spacing:.2px;display:flex;align-items:center;gap:8px;cursor:pointer;text-decoration:none;color:inherit}
.brand:hover{color:var(--brand)}
.logo{height:32px;width:auto}
.nav{display:flex;gap:16px;margin:0 12px;flex:1;overflow:auto;white-space:nowrap}
.nav a{text-decoration:none;color:#111827;font-weight:500;padding:8px 10px;border-radius:8px}
.nav a:hover{background:#f3f4f6}
.top-actions{margin-left:auto;display:flex;align-items:center;gap:12px;position:relative;flex-wrap:nowrap}
.lang,.notif,.user{font-size:14px;color:var(--muted)}
.user-btn{display:flex;align-items:center;gap:6px;cursor:pointer;color:#111827;border:1px solid var(--line);padding:6px 10px;border-radius:8px;background:#fff}
.search{position:relative}
.search input{height:34px;width:220px;padding:0 12px;border:1px solid var(--line);border-radius:8px;outline:none}

/* ---------- HISTORY SECTION ---------- */
.order-history-container {
  max-width:1100px;margin:30px auto;padding:0 20px;
}
.page-title{font-size:28px;font-weight:700;margin-bottom:20px;text-align:center}

/* Search + Tabs inline */
        .filter-section {
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#fff;
  border:1px solid var(--line);
  border-radius:12px;
  padding:20px 24px;
  margin-bottom:24px;
  gap:20px;
}
.search-box {
  position:relative;
  flex-shrink:0;
}
.search-box svg {
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  z-index:1;
  width:16px;
  height:16px;
}
.search-box input {
  padding:10px 12px 10px 40px;
  border:1px solid var(--line);
  border-radius:8px;
  width:280px;
  font-size:16px;
  outline:none;
}
.search-box input:focus {
  border-color:var(--brand);
  box-shadow:0 0 0 3px rgba(14, 165, 233, 0.1);
}
.tab-buttons {
  display:flex;
  gap:12px;
  flex:1;
  justify-content:flex-end;
}
.tab-btn {
  border:1px solid var(--line);
  background:#fff;
  padding:10px 24px;
  border-radius:8px;
  cursor:pointer;
  font-weight:500;
  font-size:16px;
  transition:all 0.2s;
  min-width:100px;
}
.tab-btn:hover {
  background:#f3f4f6;
  border-color:#9ca3af;
}
.tab-btn.active {
  background:var(--brand);
  color:#fff;
  border-color:var(--brand);
}

/* ---------- ORDER CARD ---------- */
.order-card {
  background:#fff;
  border:1px solid var(--line);
  border-radius:12px;
  padding:20px;
  margin-bottom:18px;
}
        .order-top {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:14px;
}
        .seller-info {
  display:flex;
  align-items:center;
  gap:8px;
}
.seller-info input {
  width:130px;
  padding:6px;
  border:1px solid var(--line);
  border-radius:6px;
}
        .action-btn {
  border:1px solid var(--line);
  border-radius:6px;
  padding:6px 12px;
  cursor:pointer;
}
.chat-btn {background:#3b82f6;color:#fff;border-color:#3b82f6}
.view-seller-btn {background:#ef4444;color:#fff;border-color:#ef4444}
.status {
  font-weight:600;
  color:#ef4444;
}
.status.completed {color:#059669}
.status.cancelled {color:#dc2626}

/* product part */
.product-line {
  display:flex;
  align-items:flex-start;
  gap:16px;
  margin-top:10px;
}
        .product-image {
  width:80px;height:80px;
  background:#f3f4f6;
  border:1px solid var(--line);
  border-radius:8px;
  flex-shrink:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:40px;
}
.product-info {
  flex:1;
}
        .product-name {
  font-weight:600;
  margin-bottom:6px;
}
        .order-bottom {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:14px;
}
        .order-actions {
  display:flex;
  gap:10px;
        }
        .rate-btn {
  background:#ef4444;color:#fff;border:1px solid #ef4444;
  border-radius:8px;padding:8px 14px;
}
.contact-btn, .buy-again-btn {
  border:1px solid var(--line);
  border-radius:8px;
  background:#fff;
  padding:8px 14px;
  cursor:pointer;
}
.contact-btn:hover, .buy-again-btn:hover {
  background:#f3f4f6;
}

/* Product description styles */
.product-description {
  margin-top: 8px;
  margin-bottom: 8px;
  color: #6b7280;
  font-size: 14px;
  line-height: 1.4;
  max-width: 100%;
  word-wrap: break-word;
}

/* Price display styles */
.price-info {
  margin-top: 8px;
  line-height: 1.4;
}
.sale-price {
  color: #ef4444;
  font-weight: 600;
  font-size: 16px;
}
.original-price {
  color: #6b7280;
  text-decoration: line-through;
  font-size: 14px;
}
.regular-price {
  color: #111827;
  font-weight: 600;
  font-size: 16px;
}
.price-at-time {
  color: #059669;
  font-weight: 500;
  font-size: 14px;
  background: #f0fdf4;
  padding: 2px 6px;
  border-radius: 4px;
  display: inline-block;
  margin-top: 4px;
}

/* Additional styles for new elements */
.user-menu{position:absolute; right:0; top:48px; background:#fff; border:1px solid var(--line); border-radius:10px; box-shadow:0 10px 25px rgba(0,0,0,.08); width:200px; display:none; z-index:5}
.user-menu .item{display:block; padding:10px 12px; color:#111827; text-decoration:none}
.user-menu .item:hover{background:#f3f4f6}
.cart { position:relative; width:28px; height:28px; display:grid; place-items:center; border:1px solid var(--line); border-radius:8px; text-decoration:none; color:#111827; }
.cart .badge{ position:absolute; top:-6px; right:-6px; background:#ef4444; color:#fff; min-width:18px; height:18px; border-radius:9px; font-size:11px; display:flex; align-items:center; justify-content:center; padding:0 5px; }
	</style>
</head>
<body>
	<div class="wrapper">
		<div class="topbar">
			<a href="/customer/dashboard" class="brand">
				<img src="/img/logo.jpg" alt="BanHangRong Logo" class="logo">
				BanHangRong
			</a>
    <nav class="nav">
				<a href="/categories">Category</a>
				<a href="#">License Software</a>
				<a href="#">Game Keys</a>
				<a href="#">Voucher</a>
				<a href="/support">Support</a>
			</nav>
			<div class="top-actions">
				<a href="/notification" class="notif" style="text-decoration:none;color:var(--muted);">Notification</a>
                <div class="user" style="position:relative">
                    <button id="userMenuBtn" class="user-btn" type="button" aria-haspopup="menu" aria-expanded="false">
                        <span th:text="${user != null ? user.username : 'User123456'}">User123456</span>
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5" stroke="#6b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </button>
                    <div id="userDropdown" class="user-menu" role="menu" aria-label="User menu">
                        <a class="item" th:href="@{'/customer/profile/' + ${user.username}}" role="menuitem">My Account</a>
                        <a class="item" href="/orderhistory" role="menuitem">Order History</a>
                        <form class="item" method="post" action="/wallet/vnpay/create" role="menuitem" style="display:flex;gap:8px;align-items:center" onsubmit="return topupPrompt(event)">
                            <input type="hidden" name="amount" id="topupAmountInput" />
                            <button type="submit" style="all:unset;cursor:pointer;color:#0ea5e9">üí≥ N·∫°p ti·ªÅn (VNPay)</button>
                        </form>
                        <a class="item seller-apply" href="/seller/dashboard" role="menuitem" style="background:#f8fafc;border-top:1px solid #e2e8f0;color:#0ea5e9;font-weight:600;">üìà Applied to become a seller</a>
                        <a class="item" href="#" role="menuitem" onclick="event.preventDefault(); document.getElementById('logoutForm').submit();">Logout</a>
                    </div>
                    <form id="logoutForm" method="post" action="/logout" style="display:none;">
                    </form>
                </div>
				<div class="search">
					<form method="GET" action="/customer/dashboard" style="display:flex;gap:4px;">
						<input type="search" name="search" placeholder="search" aria-label="Search" 
							   style="height:34px;width:220px;padding:0 12px;border:1px solid var(--line);border-radius:8px;outline:none;">
						<button type="submit" style="padding:8px 12px;background:var(--brand);color:#fff;border:none;border-radius:8px;cursor:pointer;">üîç</button>
					</form>
				</div>
				<a href="/cart" class="cart" title="Gi·ªè h√†ng" aria-label="Gi·ªè h√†ng">üõí<span class="badge" th:text="${cartCount}" th:if="${cartCount != null and cartCount > 0}">0</span></a>
			</div>
		</div>

        <div class="order-history-container">
                <h1 class="page-title">History Order</h1>

            <div class="filter-section">
                    <div class="search-box">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="#6b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <input type="text" placeholder="search" id="searchInput">
                    </div>
      <div class="tab-buttons">
        <button class="tab-btn active">All</button>
        <button class="tab-btn">Completed</button>
        <button class="tab-btn">Cancelled</button>
                </div>
            </div>

    <!-- Dynamic Order Cards -->
            <div th:if="${orders != null and !orders.empty}">
      <div th:each="order : ${orders}" class="order-card" th:if="${orderItemsMap != null and orderItemsMap[order.orderId] != null and !orderItemsMap[order.orderId].empty}">
                    <div class="order-top">
                        <div class="seller-info">
            <span>Seller:</span>
            <input type="text" th:value="${order.sellerId}" readonly>
                            <button class="action-btn chat-btn">Chat</button>
                            <button class="action-btn view-seller-btn">View seller</button>
                        </div>
          <div class="status" th:class="${'status ' + order.status.toLowerCase()}" th:text="'Status: ' + ${order.status}">Status: Completed</div>
                        </div>
        <div class="product-line">
          <div class="product-image">üì¶</div>
          <div class="product-info">
                            <div class="product-name" th:if="${productNamesMap != null and orderItemsMap[order.orderId] != null and !orderItemsMap[order.orderId].empty}" th:text="${productNamesMap[orderItemsMap[order.orderId][0].productId]}">Name tools</div>
            <div th:if="${orderItemsMap[order.orderId] != null and !orderItemsMap[order.orderId].empty}" th:text="'Quantities: ' + ${orderItemsMap[order.orderId][0].quantity}">Quantities: 1</div>
            <!-- Product Description -->
            <div class="product-description" th:if="${productsMap != null and orderItemsMap[order.orderId] != null and !orderItemsMap[order.orderId].empty and productsMap[orderItemsMap[order.orderId][0].productId] != null}" th:text="${productsMap[orderItemsMap[order.orderId][0].productId].description}">B·∫£o v·ªá to√†n di·ªán: Antivirus, VPN, Password Manager. 5 devices, 12 th√°ng.</div>
            
            <div class="price-info" style="margin-top: 8px;">
              <span th:if="${productsMap != null and orderItemsMap[order.orderId] != null and !orderItemsMap[order.orderId].empty and productsMap[orderItemsMap[order.orderId][0].productId] != null and productsMap[orderItemsMap[order.orderId][0].productId].salePrice != null and productsMap[orderItemsMap[order.orderId][0].productId].salePrice != productsMap[orderItemsMap[order.orderId][0].productId].price}">
                <span class="sale-price" style="color: #ef4444; font-weight: 600;" th:text="'Gi√° khuy·∫øn m√£i: ' + ${#numbers.formatDecimal(productsMap[orderItemsMap[order.orderId][0].productId].salePrice, 0, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">Gi√° khuy·∫øn m√£i: 1,100,000‚Ç´</span>
                <br>
                <span class="original-price" style="color: #6b7280; text-decoration: line-through; font-size: 14px;" th:text="'Gi√° g·ªëc: ' + ${#numbers.formatDecimal(productsMap[orderItemsMap[order.orderId][0].productId].price, 0, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">Gi√° g·ªëc: 1,250,000‚Ç´</span>
              </span>
              <span th:unless="${productsMap != null and orderItemsMap[order.orderId] != null and !orderItemsMap[order.orderId].empty and productsMap[orderItemsMap[order.orderId][0].productId] != null and productsMap[orderItemsMap[order.orderId][0].productId].salePrice != null and productsMap[orderItemsMap[order.orderId][0].productId].salePrice != productsMap[orderItemsMap[order.orderId][0].productId].price}">
                <span class="regular-price" style="color: #111827; font-weight: 600;" th:if="${productsMap != null and orderItemsMap[order.orderId] != null and !orderItemsMap[order.orderId].empty and productsMap[orderItemsMap[order.orderId][0].productId] != null}" th:text="'Gi√°: ' + ${#numbers.formatDecimal(productsMap[orderItemsMap[order.orderId][0].productId].price, 0, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">Gi√°: 1,250,000‚Ç´</span>
              </span>
              <br>
              <span class="price-at-time" style="color: #059669; font-weight: 500; font-size: 14px;" th:if="${orderItemsMap[order.orderId] != null and !orderItemsMap[order.orderId].empty}" th:text="'ƒê√£ mua v·ªõi gi√°: ' + ${#numbers.formatDecimal(orderItemsMap[order.orderId][0].priceAtTime, 0, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">ƒê√£ mua v·ªõi gi√°: 1,100,000‚Ç´</span>
            </div>
                        </div>
                    </div>
                    <div class="order-bottom">
          <div th:text="'T·ªïng ƒë∆°n h√†ng: ' + ${#numbers.formatDecimal(order.totalAmount, 0, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'" style="font-weight: 600; color: #111827;">T·ªïng ƒë∆°n h√†ng: 1,100,000‚Ç´</div>
          <div class="order-actions">
            <button class="rate-btn">Rate</button>
            <button class="contact-btn">Contact Seller</button>
            <button class="buy-again-btn">Buy again</button>
                        </div>
                        </div>
                    </div>
                </div>

    <!-- Empty State -->
    <div th:if="${orders == null or orders.empty}" class="order-card" style="text-align: center; padding: 40px;">
                <h3>No orders found</h3>
                <p>You haven't placed any orders yet.</p>
      <a href="/customer/dashboard" class="rate-btn" style="text-decoration: none; display: inline-block; margin-top: 20px;">Start Shopping</a>
            </div>
        </div>
    </div>

    <script>
        // User dropdown functionality
        document.getElementById('userMenuBtn').addEventListener('click', function() {
            const dropdown = document.getElementById('userDropdown');
            const isExpanded = this.getAttribute('aria-expanded') === 'true';
            
            this.setAttribute('aria-expanded', !isExpanded);
            dropdown.style.display = isExpanded ? 'none' : 'block';
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const userMenu = document.querySelector('.user');
            const dropdown = document.getElementById('userDropdown');
            
            if (!userMenu.contains(event.target)) {
                dropdown.style.display = 'none';
                document.getElementById('userMenuBtn').setAttribute('aria-expanded', 'false');
            }
        });

        // Filter functionality
  document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all buttons
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
                
      const status = this.textContent.toLowerCase();
                filterOrders(status);
            });
        });

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            searchOrders(searchTerm);
        });

        function filterOrders(status) {
    const orderCards = document.querySelectorAll('.order-card');
            
            orderCards.forEach(card => {
      const statusElement = card.querySelector('.status');
                const orderStatus = statusElement.textContent.toLowerCase();
                
      if (status === 'all' || orderStatus.includes(status)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function searchOrders(searchTerm) {
    const orderCards = document.querySelectorAll('.order-card');
            
            orderCards.forEach(card => {
                const productName = card.querySelector('.product-name').textContent.toLowerCase();
      const sellerId = card.querySelector('input[readonly]').value.toLowerCase();
                
                if (productName.includes(searchTerm) || sellerId.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Action button handlers
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('chat-btn')) {
                alert('Chat functionality coming soon!');
            } else if (event.target.classList.contains('view-seller-btn')) {
                alert('View seller functionality coming soon!');
            } else if (event.target.classList.contains('rate-btn')) {
                alert('Rate functionality coming soon!');
            } else if (event.target.classList.contains('contact-btn')) {
                alert('Contact seller functionality coming soon!');
            } else if (event.target.classList.contains('buy-again-btn')) {
                alert('Buy again functionality coming soon!');
            }
        });

        // VNPay topup function
        function topupPrompt(e){
            e.preventDefault();
            const v = prompt('Nh·∫≠p s·ªë ti·ªÅn mu·ªën n·∫°p (VND):', '200000');
            if(!v) return false;
            const clean = v.replace(/[^0-9]/g,'');
            if(!clean){ alert('S·ªë ti·ªÅn kh√¥ng h·ª£p l·ªá'); return false; }
            document.getElementById('topupAmountInput').value = clean;
            e.target.submit();
            return true;
        }
    </script>
</body>
</html>
