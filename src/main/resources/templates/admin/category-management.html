<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Category Management</title>
    <link rel="shortcut icon" th:href="@{/img/favicon.png}"/>
    <link rel="stylesheet" th:href="@{/css/styles.min.css}"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        .content-wrapper {
            margin-left: 260px;
            padding: 30px;
            background-color: #f8f9fa;
            min-height: 100vh;
        }


        table {
            background-color: white;
        }

        th {
            background-color: #6c8cff;
            color: white;
            text-align: center;
        }

        td, th {
            padding: 10px;
            vertical-align: middle;
        }

        tr:nth-child(even) {
            background-color: #f2f4ff;
        }

        tr:hover {
            background-color: #e5e8ff;
        }

        .action-btns {
            display: flex;
            justify-content: center;
            gap: 8px;
        }

        .action-btns button {
            background: none;
            border: none;
            cursor: pointer;
            width: 34px;
            height: 34px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .action-btns .btn-update {
            background-color: #4e73df;
        }

        .action-btns .btn-delete {
            background-color: #e74a3b;
        }

        .action-btns button i {
            color: white;
            font-size: 16px;
        }

        .action-btns button:hover {
            transform: scale(1.1);
            filter: brightness(1.1);
        }

        .form-category {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
        }

        /* chỉnh form dọc, desc dài hơn */
        .form-category .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }

        .form-category label {
            font-weight: 500;
            margin-bottom: 5px;
        }

        #nameInput {
            width: 60%;
        }

        #descInput {
            width: 90%;
        }

        .readonly-input {
            background-color: #f8f9fa;
        }
        /* Cho form cùng độ rộng với filter & table */
        .card {
            width: 100%;
        }

        /* Form căn giữa + responsive */
        @media (max-width: 768px) {
            .col-lg-6 { max-width: 100%; padding: 0 15px; }
        }

        /* Input readonly đẹp hơn */
        .readonly-input {
            background-color: #f8f9fa !important;
            color: #495057;
            cursor: not-allowed;
        }

        /* Nút to + hover đẹp */
        #actionBtn, #resetFormBtn {
            min-width: 140px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        #actionBtn:hover { transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        #resetFormBtn:hover { transform: translateY(-1px);
    </style>
</head>
<body>
<div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full">
    <!-- Sidebar -->
    <div th:replace="~{admin/sidebar::sidebar}"></div>

    <div class="content-wrapper">
        <!-- ==================== FILTER SECTION ==================== -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <form th:action="@{/admin/category/filter}" method="get" id="filterForm">
                    <div class="row g-3 align-items-end">
                        <div class="col-md-2">
                            <label class="form-label">ID</label>
                            <input type="number" class="form-control" name="id" min="0" placeholder="Enter ID">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Name</label>
                            <input type="text" class="form-control" name="name" placeholder="Category name">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Created From</label>
                            <input type="date" class="form-control" name="createdFrom">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Created To</label>
                            <input type="date" class="form-control" name="createdTo">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Updated From</label>
                            <input type="date" class="form-control" name="updatedFrom">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Updated To</label>
                            <input type="date" class="form-control" name="updatedTo">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Sort By</label>
                            <select class="form-select" name="sortBy">
                                <option value="categoryId">ID</option>
                                <option value="name">Name</option>
                                <option value="createdAt">Created At</option>
                                <option value="updatedAt">Updated At</option>
                            </select>
                        </div>
                        <div class="col-md-1">
                            <label class="form-label">Order</label>
                            <select class="form-select" name="sortOrder">
                                <option value="ASC">Asc</option>
                                <option value="DESC">Desc</option>
                            </select>
                        </div>
                    </div>

                    <div class="mt-4 d-flex gap-2 flex-wrap">
                        <button type="submit" class="btn btn-primary"><i class="bi bi-funnel"></i> Apply Filter</button>
                        <button type="button" class="btn btn-secondary" id="resetFilter"><i class="bi bi-arrow-counterclockwise"></i> Reset</button>
                        <button type="button" class="btn btn-success" id="createNewBtn"><i class="bi bi-plus-circle"></i> Create New Category</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- ==================== ALERTS ==================== -->
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- ==================== CREATE / EDIT FORM ==================== -->
        <div class="card shadow-sm mb-4 w-100">
            <div class="card-body">
                <form th:action="@{/admin/category/save}" method="post" id="categoryForm">
                    <input type="hidden" id="categoryId" name="categoryId">
                    <!-- ✅ Thêm input ẩn để xác định hành động -->
                    <input type="hidden" id="actionType" name="actionType" value="create">
                    <!-- Form group căn giữa, độ rộng cố định -->
                    <div class="row justify-content-center">
                        <div class="col-lg-6 col-md-8 col-12">

                            <!-- Name -->
                            <div class="mb-6">
                                <label class="form-label">Name <span class="text-danger">*</span></label>
                                <input
                                        type="text"
                                        class="form-control readonly-input"
                                        id="nameInput"
                                        name="name"
                                        readonly
                                        required
                                        placeholder="Nhập tên danh mục"
                                />
                            </div>

                            <!-- Description -->
                            <div class="mb-6">
                                <label class="form-label">Description</label>
                                <textarea
                                        class="form-control readonly-input"
                                        id="descInput"
                                        name="description"
                                        rows="3"
                                        readonly
                                        placeholder="Mô tả danh mục (không bắt buộc)"
                                ></textarea>
                            </div>

                            <!-- Nút: to hơn, căn giữa, khoảng cách đều -->
                            <div class="d-flex justify-content-center gap-3">
                                <button type="submit" class="btn btn-primary btn-lg px-4" id="actionBtn">
                                    <i class="bi bi-plus-circle"></i> Create
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-lg px-4" id="resetFormBtn">
                                    <i class="bi bi-arrow-counterclockwise"></i> Reset
                                </button>
                            </div>

                        </div>
                    </div>
                </form>
            </div>
        </div>


        <!-- ==================== CATEGORY TABLE ==================== -->
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-hover text-center align-middle">
                        <thead class="table-primary">
                        <tr>
                            <th style="width:100px;">Actions</th>
                            <th style="width:60px;">ID</th>
                            <th style="width:180px;">Name</th>
                            <th>Description</th>
                            <th style="width:180px;">Created At</th>
                            <th style="width:180px;">Updated At</th>
                        </tr>
                        </thead>
                        <tbody th:if="${categoryList != null and categoryList.size() > 0}">
                        <tr th:each="c : ${categoryList}">
                            <td class="action-btns">
                                <button type="button" class="btn btn-primary btn-sm btn-update"
                                        th:data-id="${c.categoryId}"
                                        th:data-name="${c.name}"
                                        th:data-desc="${c.description}">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <form th:action="@{/admin/category/delete}" method="post" class="delete-form" style="display:inline;">
                                    <input type="hidden" name="categoryId" th:value="${c.categoryId}">
                                    <button type="button" class="btn btn-danger btn-sm btn-delete"
                                            th:data-id="${c.categoryId}">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </td>
                            <td th:text="${c.categoryId}"></td>
                            <td th:text="${c.name}"></td>
                            <td th:text="${c.description}"></td>
                            <td th:text="${#temporals.format(c.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                            <td th:text="${#temporals.format(c.updatedAt, 'yyyy-MM-dd HH:mm')}"></td>
                        </tr>
                        </tbody>
                    </table>
                    <!-- Confirm Delete Modal -->
                    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content shadow-lg rounded-4 border-0">
                                <div class="modal-header bg-danger text-white">
                                    <h5 class="modal-title" id="confirmDeleteLabel">
                                        <i class="bi bi-exclamation-triangle-fill me-2"></i> Confirm Deletion
                                    </h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body text-center">
                                    <p class="fs-5">Are you sure you want to delete this category?</p>
                                    <p class="text-muted">This action cannot be undone.</p>
                                </div>
                                <div class="modal-footer justify-content-center">
                                    <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Cancel</button>
                                    <button type="button" class="btn btn-danger px-4" id="confirmDeleteBtn">Yes, Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- ==================== JS ==================== -->
<script>
    // Reset filter
    document.getElementById("resetFilter").addEventListener("click", () => {
        document.getElementById("filterForm").reset();
    });

    // Hàm bật chế độ chỉnh sửa (bỏ readonly + bỏ class readonly-input)
    function enableEditing() {
        document.querySelectorAll(".readonly-input").forEach(i => {
            i.removeAttribute("readonly");
            i.classList.remove("readonly-input");
        });
    }

    // Hàm khóa form lại (readonly + thêm class readonly-input)
    function disableEditing() {
        document.querySelectorAll("#categoryForm input, #categoryForm textarea").forEach(i => {
            i.setAttribute("readonly", true);
            i.classList.add("readonly-input");
        });
    }

    // Update button logic
    document.querySelectorAll(".btn-update").forEach(btn => {
        btn.addEventListener("click", e => {
            const id = btn.dataset.id;
            const name = btn.dataset.name;
            const desc = btn.dataset.desc;

            document.getElementById("categoryId").value = id;
            document.getElementById("nameInput").value = name;
            document.getElementById("descInput").value = desc;

            enableEditing(); // ✅ Cho phép nhập

            const actionBtn = document.getElementById("actionBtn");
            actionBtn.innerHTML = '<i class="bi bi-pencil"></i> Update';
            actionBtn.classList.remove("btn-primary");
            actionBtn.classList.add("btn-warning");

            // Set action type
            document.getElementById("actionType").value = "update";
        });
    });

    // Create new
    document.getElementById("createNewBtn").addEventListener("click", () => {
        document.getElementById("categoryForm").reset();
        enableEditing(); // ✅ Cho phép nhập

        const actionBtn = document.getElementById("actionBtn");
        actionBtn.innerHTML = '<i class="bi bi-plus-circle"></i> Create';
        actionBtn.classList.remove("btn-warning");
        actionBtn.classList.add("btn-primary");

        // Set action type
        document.getElementById("actionType").value = "create";
    });

    // Reset form (xóa dữ liệu & khóa lại)
    document.getElementById("resetFormBtn").addEventListener("click", () => {
        document.getElementById("categoryForm").reset();
        disableEditing(); // ✅ Khóa lại

        const actionBtn = document.getElementById("actionBtn");
        actionBtn.innerHTML = '<i class="bi bi-plus-circle"></i> Create';
        actionBtn.classList.remove("btn-warning");
        actionBtn.classList.add("btn-primary");

        // Reset về create mặc định
        document.getElementById("actionType").value = "create";
    });


    document.addEventListener("DOMContentLoaded", function () {
        let selectedForm = null;
        const confirmModal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
        const confirmButton = document.getElementById('confirmDeleteBtn');

        // Khi click nút xóa → mở modal
        document.querySelectorAll('.btn-delete').forEach(button => {
            button.addEventListener('click', function () {
                selectedForm = this.closest('form');
                confirmModal.show();
            });
        });

        // Khi click xác nhận → submit form thật
        confirmButton.addEventListener('click', function () {
            if (selectedForm) {
                selectedForm.submit();
            }
        });
    });
</script>

</body>
</html>
