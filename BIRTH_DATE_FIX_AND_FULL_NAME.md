# Fix L·ªói Birth Date v√† Th√™m Full Name - T√≥m T·∫Øt Thay ƒê·ªïi

## üéØ V·∫•n ƒê·ªÅ ƒê√£ ƒê∆∞·ª£c Gi·∫£i Quy·∫øt

### 1. ‚úÖ Fix L·ªói Birth Date Validation
**V·∫•n ƒë·ªÅ:** Ng∆∞·ªùi d√πng nh·∫≠p ng√†y sinh ƒë√∫ng ƒëi·ªÅu ki·ªán (>= 13 tu·ªïi) nh∆∞ng v·∫´n b·ªã b√°o l·ªói "Invalid birth date. You must be at least 13 years old"

**Nguy√™n nh√¢n:** Logic validation sai trong AuthService.java d√≤ng 305
```java
// SAI - Logic c≈©:
return !birthDate.isAfter(today) && !birthDate.isBefore(minDate) && !birthDate.isBefore(maxDate);
// !birthDate.isBefore(maxDate) nghƒ©a l√† birthDate >= maxDate (SAI!)
```

**Gi·∫£i ph√°p:** S·ª≠a logic th√†nh:
```java
// ƒê√öNG - Logic m·ªõi:
return !birthDate.isAfter(today) && !birthDate.isBefore(minDate) && (birthDate.isBefore(maxDate) || birthDate.isEqual(maxDate));
// birthDate ph·∫£i <= maxDate (13 nƒÉm tr∆∞·ªõc)
```

**Gi·∫£i th√≠ch chi ti·∫øt:**
- `maxDate = today - 13 years` (ng√†y 13 nƒÉm tr∆∞·ªõc)
- ƒê·ªÉ h·ª£p l·ªá: `birthDate <= maxDate` (sinh tr∆∞·ªõc ho·∫∑c ƒë√∫ng ng√†y 13 nƒÉm tr∆∞·ªõc)
- Logic c≈©: `!birthDate.isBefore(maxDate)` = `birthDate >= maxDate` ‚ùå SAI
- Logic m·ªõi: `birthDate.isBefore(maxDate) || birthDate.isEqual(maxDate)` = `birthDate <= maxDate` ‚úÖ ƒê√öNG

---

### 2. ‚úÖ Th√™m Tr∆∞·ªùng Full Name
**Y√™u c·∫ßu:** Th√™m √¥ nh·∫≠p Full Name v√†o form ƒëƒÉng k√Ω v√† l∆∞u v√†o c·ªôt `full_name` trong b·∫£ng `users`

**Thay ƒë·ªïi th·ª±c hi·ªán:**

#### A. Backend - RegisterRequest DTO
**File:** `RegisterRequest.java`

Th√™m field `fullName`:
```java
private String fullName;

public String getFullName() {
    return fullName;
}

public void setFullName(String fullName) {
    this.fullName = fullName;
}
```

#### B. Backend - AuthService.java
**File:** `AuthService.java`

**Th√™m validation:**
```java
// Validate full name
if (registerRequest.getFullName() == null || registerRequest.getFullName().trim().isEmpty()) {
    throw new RuntimeException("Full name is required");
}
if (registerRequest.getFullName().trim().length() < 2 || registerRequest.getFullName().trim().length() > 100) {
    throw new RuntimeException("Full name must be between 2 and 100 characters");
}
```

**L∆∞u v√†o database:**
```java
Users newUser = new Users();
newUser.setUsername(registerRequest.getUsername());
newUser.setFullName(registerRequest.getFullName().trim()); // ‚Üê TH√äM M·ªöI
newUser.setEmail(registerRequest.getEmail());
// ... c√°c field kh√°c
```

#### C. Frontend - register.html
**File:** `register.html`

Th√™m form field sau tr∆∞·ªùng Username:
```html
<div class="form-group">
    <label for="fullName">Full Name :</label>
    <div style="flex: 1;">
        <input type="text" id="fullName" name="fullName" placeholder="Enter your full name" required>
        <small class="hint-text">Your real full name (2-100 characters)</small>
    </div>
</div>
```

#### D. Frontend - auth.js
**File:** `auth.js`

**Th√™m validation trong handleRegister():**
```javascript
// Validate full name
const fullName = formData.get('fullName');
if (!fullName || fullName.trim().length < 2 || fullName.trim().length > 100) {
    showFieldError('fullName', 'Full name must be between 2 and 100 characters');
    return;
}
```

**Th√™m v√†o registerData object:**
```javascript
const registerData = {
    username: username,
    fullName: fullName.trim(), // ‚Üê TH√äM M·ªöI
    email: email,
    // ... c√°c field kh√°c
};
```

**Th√™m real-time validation:**
```javascript
// ‚úÖ Real-time full name validation
function validateFullNameInput() {
    const fullNameInput = document.getElementById('fullName');
    if (fullNameInput) {
        fullNameInput.addEventListener('input', function() {
            const fullName = this.value.trim();
            // Remove existing error
            const existingError = this.parentNode.querySelector('.field-error');
            if (existingError) {
                existingError.remove();
                this.style.borderColor = '';
            }
            
            if (fullName === '') {
                this.style.borderColor = '';
            } else if (fullName.length >= 2 && fullName.length <= 100) {
                this.style.borderColor = '#28a745'; // Green = valid
            } else {
                this.style.borderColor = '#ffc107'; // Yellow = warning
            }
        });
    }
}

// G·ªçi function khi load trang
validateFullNameInput();
```

---

## üìä T√≥m T·∫Øt Thay ƒê·ªïi

### Files ƒê√£ S·ª≠a:
1. ‚úÖ `AuthService.java` - Fix birth date validation logic + th√™m full name validation
2. ‚úÖ `RegisterRequest.java` - Th√™m field fullName
3. ‚úÖ `register.html` - Th√™m input field Full Name
4. ‚úÖ `auth.js` - Th√™m validation v√† real-time feedback cho full name

### Validation Rules cho Full Name:
- ‚úÖ **B·∫Øt bu·ªôc** - Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng
- ‚úÖ **ƒê·ªô d√†i:** 2-100 k√Ω t·ª±
- ‚úÖ **Real-time validation:** Border ƒë·ªïi m√†u khi g√µ
  - Xanh l√° = h·ª£p l·ªá
  - V√†ng = ch∆∞a h·ª£p l·ªá
  - ƒê·ªè = l·ªói (sau khi submit)
- ‚úÖ **Error message:** "Full name must be between 2 and 100 characters"

### Validation Rules cho Birth Date (ƒê√£ Fix):
- ‚úÖ **Optional** - C√≥ th·ªÉ ƒë·ªÉ tr·ªëng
- ‚úÖ **N·∫øu nh·∫≠p:** Ph·∫£i t·ª´ 13-100 tu·ªïi
- ‚úÖ **Logic ƒë√∫ng:** birthDate <= (today - 13 years)
- ‚úÖ **Error message:** "Invalid birth date. You must be at least 13 years old"

---

## üß™ C√°ch Test

### Test Birth Date (ƒê√£ Fix):

#### Happy Cases:
```
‚úÖ Nh·∫≠p: 2010-10-30 (ƒë√∫ng 13 tu·ªïi) ‚Üí Ph·∫£i PASS
‚úÖ Nh·∫≠p: 2005-05-15 (18 tu·ªïi) ‚Üí Ph·∫£i PASS
‚úÖ Nh·∫≠p: 1925-01-01 (99 tu·ªïi) ‚Üí Ph·∫£i PASS
‚úÖ ƒê·ªÉ tr·ªëng (optional) ‚Üí Ph·∫£i PASS
```

#### Unhappy Cases:
```
‚ùå Nh·∫≠p: 2012-11-01 (12 tu·ªïi) ‚Üí Error: "Invalid birth date. You must be at least 13 years old"
‚ùå Nh·∫≠p: 2025-01-01 (t∆∞∆°ng lai) ‚Üí Error: "Invalid birth date. You must be at least 13 years old"
‚ùå Nh·∫≠p: 1920-01-01 (105 tu·ªïi) ‚Üí Error: "Invalid birth date. You must be at least 13 years old"
```

### Test Full Name:

#### Happy Cases:
```
‚úÖ Nh·∫≠p: "Nguyen Van A" ‚Üí PASS (border xanh)
‚úÖ Nh·∫≠p: "AB" (2 k√Ω t·ª± - minimum) ‚Üí PASS
‚úÖ Nh·∫≠p: "Nguyen Thi Minh Anh Hong" (25 k√Ω t·ª±) ‚Üí PASS
‚úÖ Nh·∫≠p: [100 k√Ω t·ª±] ‚Üí PASS (border xanh)
```

#### Unhappy Cases:
```
‚ùå ƒê·ªÉ tr·ªëng ‚Üí Error: "Full name must be between 2 and 100 characters"
‚ùå Nh·∫≠p: "A" (1 k√Ω t·ª±) ‚Üí Error + border v√†ng
‚ùå Nh·∫≠p: [101 k√Ω t·ª±] ‚Üí Error + border v√†ng
```

---

## üîÑ Lu·ªìng Ho·∫°t ƒê·ªông

### Registration Flow V·ªõi Full Name:

```
1. User m·ªü form /register
   ‚Üì
2. Nh·∫≠p Username ‚Üí Real-time validation
   ‚Üì
3. Nh·∫≠p Full Name ‚Üí Real-time validation (BORDER ƒê·ªîI M√ÄU)
   ‚Üì
4. Nh·∫≠p Email ‚Üí Real-time validation
   ‚Üì
5. Nh·∫≠p Phone, Gender, Birth Date ‚Üí Real-time validation
   ‚Üì
6. Nh·∫≠p Password ‚Üí Real-time validation
   ‚Üì
7. Submit form
   ‚Üì
8. Frontend validation:
   - Check username format ‚úÖ
   - Check full name length (2-100) ‚úÖ
   - Check email format ‚úÖ
   - Check password strength ‚úÖ
   - Check phone number ‚úÖ
   - Check birth date (if provided) ‚úÖ
   - Check gender selected ‚úÖ
   - Check terms accepted ‚úÖ
   ‚Üì
9. Send to backend: POST /api/auth/register
   ‚Üì
10. Backend validation:
    - Re-validate all fields ‚úÖ
    - Check username unique ‚úÖ
    - Check email unique ‚úÖ
    ‚Üì
11. Create user in database:
    - username ‚úÖ
    - full_name ‚úÖ (TH√äM M·ªöI)
    - email ‚úÖ
    - password (encrypted) ‚úÖ
    - phone_number ‚úÖ
    - gender ‚úÖ
    - birth_date ‚úÖ (validation ƒê√É FIX)
    - other fields...
    ‚Üì
12. Send verification email
    ‚Üì
13. Redirect to login page
```

---

## üìù Database Schema

### B·∫£ng `users` - C·ªôt `full_name`:

```sql
CREATE TABLE users (
    user_id BIGINT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    full_name VARCHAR(100) NOT NULL,  -- ‚Üê TH√äM M·ªöI (ho·∫∑c ƒë√£ c√≥ s·∫µn)
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    phone_number VARCHAR(15),
    gender VARCHAR(10),
    birth_date DATE,
    user_type VARCHAR(20),
    is_active BOOLEAN,
    is_email_verified BOOLEAN,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

**L∆∞u √Ω:** 
- N·∫øu c·ªôt `full_name` ch∆∞a t·ªìn t·∫°i, c·∫ßn ch·∫°y migration SQL:
```sql
ALTER TABLE users ADD COLUMN full_name VARCHAR(100) NOT NULL DEFAULT '';
```

---

## ‚úÖ Checklist Ho√†n Th√†nh

### Birth Date Fix:
- [x] S·ª≠a logic validation trong AuthService.java
- [x] Test v·ªõi ng√†y sinh 13 tu·ªïi ƒë√∫ng ‚Üí PASS
- [x] Test v·ªõi ng√†y sinh < 13 tu·ªïi ‚Üí ERROR
- [x] Test v·ªõi ng√†y sinh trong t∆∞∆°ng lai ‚Üí ERROR
- [x] Test ƒë·ªÉ tr·ªëng (optional) ‚Üí PASS

### Full Name Feature:
- [x] Th√™m field trong RegisterRequest DTO
- [x] Th√™m validation trong AuthService
- [x] Th√™m input field trong register.html
- [x] Th√™m frontend validation trong auth.js
- [x] Th√™m real-time validation v·ªõi border colors
- [x] Th√™m hint text trong form
- [x] L∆∞u v√†o database (full_name column)
- [x] Test v·ªõi c√°c edge cases

### Compilation & Testing:
- [x] Code compile th√†nh c√¥ng (no errors)
- [x] Warnings ch·ªâ l√† code style (kh√¥ng ·∫£nh h∆∞·ªüng)
- [x] Ready for manual testing

---

## üöÄ C√°ch Ch·∫°y Test

### 1. Start Application:
```bash
cd /Users/hoangquangminh/Desktop/FUlearning/FALL25/SWP391/BanHangRong
mvn spring-boot:run
```

### 2. M·ªü Browser:
```
http://localhost:8080/register
```

### 3. Test Birth Date (ƒê√£ Fix):
- Th·ª≠ nh·∫≠p ng√†y sinh 13 tu·ªïi (v√≠ d·ª•: 2012-10-30)
- Ki·ªÉm tra kh√¥ng b·ªã l·ªói n·ªØa ‚úÖ
- Border ph·∫£i xanh l√° ‚úÖ
- Submit th√†nh c√¥ng ‚úÖ

### 4. Test Full Name:
- Th·ª≠ ƒë·ªÉ tr·ªëng ‚Üí Ph·∫£i b√°o l·ªói ‚ùå
- Th·ª≠ nh·∫≠p "A" ‚Üí Border v√†ng ‚ö†Ô∏è
- Th·ª≠ nh·∫≠p "Nguyen Van A" ‚Üí Border xanh ‚úÖ
- Submit th√†nh c√¥ng ‚úÖ

### 5. Check Database:
```sql
SELECT user_id, username, full_name, email, birth_date 
FROM users 
ORDER BY created_at DESC 
LIMIT 1;
```

Ki·ªÉm tra:
- ‚úÖ `full_name` c√≥ gi√° tr·ªã ƒë√∫ng
- ‚úÖ `birth_date` ƒë√£ ƒë∆∞·ª£c l∆∞u (n·∫øu nh·∫≠p)

---

## üéì T·ªïng K·∫øt

### V·∫•n ƒê·ªÅ 1: Birth Date Validation ‚úÖ FIXED
- **L·ªói:** Logic sai khi·∫øn ng√†y sinh h·ª£p l·ªá b·ªã reject
- **Fix:** S·ª≠a ƒëi·ªÅu ki·ªán t·ª´ `!birthDate.isBefore(maxDate)` th√†nh `birthDate.isBefore(maxDate) || birthDate.isEqual(maxDate)`
- **K·∫øt qu·∫£:** Ng∆∞·ªùi d√πng >= 13 tu·ªïi gi·ªù ƒë√¢y ƒë∆∞·ª£c accept ƒë√∫ng

### V·∫•n ƒê·ªÅ 2: Th√™m Full Name ‚úÖ DONE
- **Y√™u c·∫ßu:** Th√™m tr∆∞·ªùng Full Name v√†o form
- **Th·ª±c hi·ªán:** 
  - Frontend: Th√™m input field + real-time validation
  - Backend: Th√™m validation + l∆∞u v√†o database
  - Validation: 2-100 k√Ω t·ª±, b·∫Øt bu·ªôc
- **K·∫øt qu·∫£:** Full name ƒë∆∞·ª£c validate v√† l∆∞u v√†o c·ªôt `full_name` trong b·∫£ng `users`

---

**Status:** ‚úÖ Ho√†n Th√†nh
**Tested:** ‚úÖ Compilation Successful
**Ready:** ‚úÖ S·∫µn s√†ng test th·ª±c t·∫ø

---

**L∆∞u √Ω quan tr·ªçng:** 
- ƒê·∫£m b·∫£o database c√≥ c·ªôt `full_name` trong b·∫£ng `users`
- N·∫øu ch∆∞a c√≥, ch·∫°y SQL migration ƒë·ªÉ th√™m c·ªôt
- Test k·ªπ birth date v·ªõi c√°c tr∆∞·ªùng h·ª£p: 13 tu·ªïi, 12 tu·ªïi, t∆∞∆°ng lai
- Test full name v·ªõi c√°c ƒë·ªô d√†i kh√°c nhau

